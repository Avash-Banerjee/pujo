{% extends "base.html" %}
{% block content %}
<div class="flex justify-center items-center h-screen bg-gray-100">
  <div id="profile-card" class="bg-white p-6 rounded-2xl shadow-lg w-96 text-center hidden">
    <img id="profile-pic" class="w-32 h-32 rounded-full mx-auto mb-4 object-cover" src="" alt="Profile Picture">
    <h2 id="profile-name" class="text-xl font-bold"></h2>
    <p id="profile-age" class="text-gray-600"></p>
    <p id="profile-bio" class="mt-2 text-sm text-gray-800"></p>

    <div class="flex justify-between mt-6">
      <button onclick="passProfile()" class="bg-gray-300 text-black px-4 py-2 rounded-xl">Pass</button>
      <button onclick="likeProfile()" class="bg-pink-500 text-white px-4 py-2 rounded-xl">Like</button>
    </div>

    <div class="mt-4">
      <a id="view-full-profile" href="#" class="text-blue-600 underline">View Full Profile</a>
    </div>
  </div>

  <p id="no-profiles" class="text-gray-600 hidden">No profiles available. Try again later!</p>
</div>

<script>
let currentProfile = null;

async function fetchNextProfile() {
  const res = await fetch("/next-profile");
  if (res.ok) {
    const data = await res.json();
    if (data.error) {
      document.getElementById("profile-card").classList.add("hidden");
      document.getElementById("no-profiles").classList.remove("hidden");
    } else {
      currentProfile = data;
      document.getElementById("profile-card").classList.remove("hidden");
      document.getElementById("no-profiles").classList.add("hidden");
      document.getElementById("profile-pic").src = data.profile_picture || "/static/default-pic.png";
      document.getElementById("profile-name").innerText = data.name;
      document.getElementById("profile-age").innerText = data.age ? `Age: ${data.age}` : "";
      document.getElementById("profile-bio").innerText = data.bio || "";
      document.getElementById("view-full-profile").href = `/profile/${data.id}`;
    }
  }
}

async function likeProfile() {
  if (!currentProfile) return;
  const res = await fetch(`/like/${currentProfile.id}`, {method: "POST"});
  const data = await res.json();
  console.log("Like result:", data);
  fetchNextProfile(); // show next one
}

function passProfile() {
  fetchNextProfile(); // just skip
}

fetchNextProfile();
</script>
{% endblock %}
